<!doctype html>
<html>
  <head>
    <title>Socket.IO  three.js</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      canvas { width: 100%; height: 100% }
    </style>
  </head>
  <body></body>

<script src="https://code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/node_modules/three/build/three.min.js"></script>
<script src="/node_modules/three/examples/js/controls/OrbitControls.js"></script>

<script>

  var scene = new THREE.Scene();
  scene.background = new THREE.Color( 0xcccccc );
  scene.fog = new THREE.FogExp2( 0xcccccc, 0.002 );

  var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
  var controls = new THREE.OrbitControls( camera );
  camera.position.z = 100;
  controls.update();

  var renderer = new THREE.WebGLRenderer();
  renderer.setSize( window.innerWidth, window.innerHeight );
  document.body.appendChild( renderer.domElement );

  var head_mesh;
    loader = new THREE.JSONLoader();
    loader.load( 'WaltHeadLo.js', function ( geometry ) {
      head_mesh = new THREE.Mesh( geometry, new THREE.MeshNormalMaterial( { overdraw: 0.5 } ) );
      scene.add( head_mesh );
      renderer.render(scene, camera);
    } )

  // lights
  var light = new THREE.DirectionalLight( 0xffffff );
  light.position.set( 1, 1, 1 );
  scene.add( light );
  var light = new THREE.DirectionalLight( 0x002288 );
  light.position.set( -1, -1, -1 );
  scene.add( light );
  var light = new THREE.AmbientLight( 0x222222 );
  scene.add( light );

  controls.addEventListener( 'change', function(){
    renderer.render(scene, camera);
  }); 
  renderer.render(scene, camera);


  var socket = io();
  socket.on('message', function(data) {
    var data_obj = JSON.parse(data.replace(/nan/g, 'null'));
    cube.position.x = data_obj.g[0]*10;
    cube.position.y = data_obj.g[1]*10;
    cube.position.z = data_obj.g[2]*10;
    cube.updateMatrix();
    renderer.render(scene, camera);

    console.log(data);
  });
</script>
    
</html>